<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio - Rental & Control</title>

    <link rel="icon" href="../img/logo_icono.webp" type="image/x-icon">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/main.css">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.14.5/dist/sweetalert2.min.css" rel="stylesheet">

    <!-- STYLE PAGE -->
    <link rel="stylesheet" href="../css/configuracion.css">
</head>

<body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-custom p-2">
        <div class="container-fluid">

            <!-- COLUMN 1: LOGO AND PLAN -->
            <div class="d-flex align-items-center">
                <a href="../pages/main.html" class="navbar-brand">
                    <img src="../img/logo_2.png" alt="Logo">
                </a>
                <span class="navbar-text plan align-self-end">Premium</span>
            </div>

            <!-- COLUMN 2: USER -->
            <div class="user-section">
                <span id="user-email" class="navbar-text">Usuario</span>
                <div class="dropdown">
                    <a class="btn" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-user nab"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end bg-dark">
                        <li><a class="dropdown-item text-light" href="configuracion.html">Configuración</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item text-light" href="#" id="logout">Cerrar sesión</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- MAIN -->
    <div class="container-fluid h-100">

        <!-- SIDEBAR -->
        <aside id="sidebar">
            <div class="d-flex flex-column align-items-start p-3">

                <!-- SECTION: NAV -->
                <section class="sidebar-section">
                    <h5 class="sidebar-section-title">NAVEGACIÓN</h5>
                    <a href="main.html" class="my-2 d-flex align-items-center">
                        <span class="icon"><i class="fas fa-pencil me-2"></i></span>
                        <span class="text">Inicio</span>
                    </a>
                    <a href="inmuebles.html" class="my-2 d-flex align-items-center">
                        <span class="icon"><i class="fas fa-home me-2"></i></span>
                        <span class="text">Inmuebles</span>
                    </a>
                    <a href="rentas.html" class="my-2 d-flex align-items-center">
                        <span class="icon"><i class="fas fa-file-invoice-dollar me-2"></i></span>
                        <span class="text">Rentas</span>
                    </a>
                </section>

                <!-- SECTION: EXTRA -->
                <section class="sidebar-section">
                    <h5 class="sidebar-section-title">EXTRA</h5>
                    <a href="notas.html" class="my-2 d-flex align-items-center">
                        <span class="icon"><i class="fas fa-sticky-note me-2"></i></span>
                        <span class="text">Notas</span>
                    </a>
                </section>

                <!-- SECTION: SUPPORT -->
                <section class="sidebar-section">
                    <h5 class="sidebar-section-title">CONTACTO</h5>
                    <div class="card bg-dark text-white">
                        <div class="card-body">
                            <h6 class="card-title">Ponte en contacto con nosotros</h6>
                            <p class="card-text">Si tienes alguna duda o necesitas más información, no dudes en
                                escribirnos o llamarnos.</p>
                            <a href="#" data-bs-toggle="modal" data-bs-target="#supportModal"
                                class="btn btn-outline-light btn-sm">Soporte</a>
                        </div>
                    </div>
                </section>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content p-3">

            <!-- CONTENT: PAGE -->
            <section id="mainContent">
                <div class="text-center">
                    <h2>Configuración de Cuenta</h2>
                    <div class="config-content">
                        <div class="settings-option">
                            <button class="btn btn-primary mt-3" id="changeEmailBtn" data-bs-toggle="modal"
                                data-bs-target="#changeEmailModal">Cambiar Correo Electrónico</button>
                        </div>
                        <div class="settings-option">
                            <button class="btn btn-secondary mt-3" id="changePasswordBtn" data-bs-toggle="modal"
                                data-bs-target="#changePasswordModal">Cambiar Contraseña</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Modal for changing email -->
            <div class="modal fade" id="changeEmailModal" tabindex="-1" aria-labelledby="changeEmailModalLabel"
                aria-hidden="true" data-bs-backdrop="static">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="changeEmailModalLabel">Cambiar Correo Electrónico</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body" id="changeEmailModalBody">
                            <div class="mb-3">
                                <label for="currentPasswordForEmail" class="form-label">Contraseña</label>
                                <input type="password" class="form-control" id="currentPasswordForEmail"
                                    placeholder="Ingresa tu contraseña">
                                <div id="currentPasswordForEmailError" class="text-danger d-none">Contraseña incorrecta
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer" id="changeEmailModalFooter">
                            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cerrar</button>
                            <button type="button" class="btn btn-primary"
                                id="submitCurrentPasswordForEmail">Continuar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal for changing password -->
            <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel"
                aria-hidden="true" data-bs-backdrop="static">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="changePasswordModalLabel">Cambiar Contraseña</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body" id="changePasswordModalBody">
                            <div class="mb-3">
                                <label for="currentPassword" class="form-label">Contraseña Actual</label>
                                <input type="password" class="form-control" id="currentPassword"
                                    placeholder="Ingresa tu contraseña actual">
                                <div id="currentPasswordError" class="text-danger d-none">Contraseña actual incorrecta
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer" id="changePasswordModalFooter">
                            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cerrar</button>
                            <button type="button" class="btn btn-primary" id="submitCurrentPassword">Continuar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FOOTER: COPYRIGHT -->
            <footer class="footer">
                <p>&copy; 2024 RentalControl. Todos los derechos reservados.</p>
            </footer>
        </main>
    </div>

    <!-- MODAL: SUPPORT -->
    <div class="modal fade" id="supportModal" data-bs-backdrop="static" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <!-- MODAL: HEADER -->
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">
                        Formulario de Soporte
                    </h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <!-- MODAL: BODY -->
                <div class="modal-body">
                    <!-- SELECT TYPE SUPPORT -->
                    <div class="mb-3">
                        <label for="supportOption" class="form-label">Selecciona el tipo de soporte</label>
                        <select class="form-select" id="supportOption" onchange="toggleForm()">
                            <option value="" disabled selected>Elige una opción</option>
                            <option value="plan">Planes</option>
                            <option value="asistencia">Asistencia Técnica</option>
                        </select>
                    </div>

                    <!-- FORM: PLANS -->
                    <div id="plansForm" class="d-none">
                        <h5>Información del Plan</h5>
                        <p>
                            Por favor, ingresa tus datos para contratar o actualizar tu
                            plan. Nos pondremos en contacto contigo por teléfono o correo
                            para completar el proceso.
                        </p>

                        <!-- OPTIONS -->
                        <button class="btn btn-primary w-100" onclick="choosePlan('contratar')">
                            Contratar un Plan
                        </button>
                        <button class="btn btn-secondary w-100 mt-2" onclick="choosePlan('actualizar')">
                            Actualizar Plan
                        </button>

                        <!-- OPTIONS -->
                        <div id="planOptions" class="d-none mt-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="plan" id="proPlan" value="pro" />
                                <label class="form-check-label" for="proPlan">
                                    Plan Basic - $29.00 USD/mes
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="plan" id="premiumPlan"
                                    value="premium" />
                                <label class="form-check-label" for="premiumPlan">
                                    Plan Pro - $49.00 USD/mes
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="plan" id="diamondPlan"
                                    value="diamond" />
                                <label class="form-check-label" for="diamondPlan">
                                    Plan Premium - $99.00 USD/mes
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- TECHNICAL ASSISTANCE -->
                    <div id="supportForm" class="d-none">
                        <h5>Formulario de Asistencia Técnica</h5>
                        <p>
                            Por favor, ingresa tus datos para que podamos ayudarte. Nos
                            pondremos en contacto contigo por teléfono o correo.
                        </p>

                        <!-- TYPE OF HELP -->
                        <div class="mb-3">
                            <label for="helpType" class="form-label">Tipo de ayuda que necesitas</label>
                            <select class="form-select" id="helpType">
                                <option value="" disabled selected>
                                    Selecciona un tipo de ayuda
                                </option>
                                <option value="general">Consulta general</option>
                                <option value="tecnico">Asistencia técnica</option>
                                <option value="facturacion">Problemas de facturación</option>
                                <option value="cuenta">Problemas con la cuenta</option>
                            </select>
                        </div>
                    </div>

                    <hr />

                    <!-- INPUT FIELDS -->
                    <div id="commonFields" class="d-none">
                        <div class="mb-3">
                            <label for="userName" class="form-label">Nombre Completo</label>
                            <input type="text" class="form-control" id="userName" placeholder="Tu nombre completo"
                                required />
                            <div class="invalid-feedback" id="nameError">
                                Por favor, ingresa tu nombre completo.
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="userPhone" class="form-label">Teléfono</label>
                            <input type="tel" class="form-control" id="userPhone" placeholder="Tu número de teléfono"
                                required pattern="^[+]?[0-9]{10,15}$" />
                            <div class="invalid-feedback" id="phoneError">
                                Por favor, ingresa un número de teléfono válido (ejemplo:
                                +1234567890).
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="userEmail" class="form-label">Correo Electrónico</label>
                            <input type="email" class="form-control" id="userEmail" placeholder="Tu correo electrónico"
                                required />
                            <div class="invalid-feedback" id="emailError">
                                Por favor, ingresa un correo electrónico válido.
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="userMessage" class="form-label">Descripción de la consulta</label>
                            <textarea class="form-control" id="userMessage" rows="4"
                                placeholder="Describe tu consulta o solicitud" required></textarea>
                            <div class="invalid-feedback" id="messageError">
                                Por favor, ingresa una descripción de tu consulta.
                            </div>
                        </div>

                        <!-- SHOW SUPPORT SELECTED -->
                        <div id="selectedOption" class="d-none mb-3">
                            <label for="selectedOptionText" class="form-label">Opción seleccionada</label>
                            <textarea class="form-control" id="selectedOptionText" rows="2" disabled></textarea>
                        </div>
                    </div>
                </div>

                <!-- MODAL: FOOTER -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
                        Cerrar
                    </button>
                    <button type="button" class="btn btn-success" id="submitBtn">
                        Enviar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPTS JAVASCRIPT -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://kit.fontawesome.com/39d6703737.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.14.5/dist/sweetalert2.all.min.js"></script>
    <script src="../js/support.js"></script>
    <script type="module" src="../js/auth.js"></script>
    <script type="module" src="../js/configuracion.js"></script>
    <script>
        // Obtén el correo del usuario desde localStorage
        const userEmail = localStorage.getItem('userEmail');

        // Actualiza el contenido del elemento con el ID 'user-email'
        if (userEmail) {
            document.getElementById('user-email').textContent = userEmail;
        }

        // Manejar el cierre de sesión
        document.getElementById('logout').addEventListener('click', () => {
            import('../js/firebaseconfig.js').then(({ auth, signOut }) => {
                signOut(auth).then(() => {
                    localStorage.removeItem('userEmail');
                    window.location.href = '../pages/login.html';
                }).catch((error) => {
                    console.error('Error al cerrar sesión:', error);
                });
            });
        });
    </script>
</body>

</html>