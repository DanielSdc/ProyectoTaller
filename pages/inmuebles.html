<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inmuebles - Rental & Control</title>

    <link rel="icon" href="../img/logo_icono.webp" type="image/x-icon" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../css/main.css" />
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.14.5/dist/sweetalert2.min.css" rel="stylesheet" />

    <!-- STYLE PAGE -->
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link rel="stylesheet" href="../css/inmuebles.css" />
    <script type="module" src="../js/tabla.js"></script>
    <script type="module" src="../js/auth.js"></script>
</head>

<body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-custom p-2">
        <div class="container-fluid">
            <!-- COLUMN 1: LOGO AND PLAN -->
            <div class="d-flex align-items-center">
                <a href="../pages/main.html" class="navbar-brand">
                    <img src="../img/logo_2.png" alt="Logo" />
                </a>
                <span class="navbar-text plan align-self-end">Premium</span>
            </div>
            <button id="toggle-sidebar" class="btn btn-outline-light d-lg-none ms-auto">
                <i class="fas fa-bars"></i>
            </button>
            <!-- COLUMN 2: USER -->
            <div class="user-section">
                <span id="user-email" class="navbar-text">Usuario</span>
                <div class="dropdown">
                    <a class="btn" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-user nab"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end bg-light">
                        <li>
                            <a class="dropdown-item" href="configuracion.html">Configuración</a>
                        </li>
                        <li>
                            <hr class="dropdown-divider" />
                        </li>
                        <li>
                            <a class="dropdown-item" href="#" id="logout">Cerrar sesión</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- MAIN -->
    <div class="container-fluid">
        <!-- SIDEBAR -->
        <aside id="sidebar">
            <div class="d-flex flex-column align-items-start p-3">
                <!-- SECTION: NAV -->
                <section class="sidebar-section">
                    <h5 class="sidebar-section-title">NAVEGACIÓN</h5>
                    <a href="main.html" class="my-2 d-flex align-items-center">
                        <span class="icon"><i class="fas fa-pencil me-2"></i></span>
                        <span class="text">Inicio</span>
                    </a>
                    <a href="inmuebles.html" class="my-2 d-flex align-items-center">
                        <span class="icon"><i class="fas fa-home me-2"></i></span>
                        <span class="text">Inmuebles</span>
                    </a>
                    <a href="rentas.html" class="my-2 d-flex align-items-center">
                        <span class="icon"><i class="fas fa-file-invoice-dollar me-2"></i></span>
                        <span class="text">Rentas</span>
                    </a>
                </section>

                <!-- SECTION: EXTRA -->
                <section class="sidebar-section">
                    <h5 class="sidebar-section-title">EXTRA</h5>
                    <a href="notas.html" class="my-2 d-flex align-items-center">
                        <span class="icon"><i class="fas fa-sticky-note me-2"></i></span>
                        <span class="text">Notas</span>
                    </a>
                </section>

                <!-- SECTION: SUPPORT -->
                <section class="sidebar-section">
                    <h5 class="sidebar-section-title">CONTACTO</h5>
                    <div class="card bg-dark text-white">
                        <div class="card-body">
                            <h6 class="card-title">Ponte en contacto con nosotros</h6>
                            <p class="card-text">
                                Si tienes alguna duda o necesitas más información, no dudes en
                                escribirnos o llamarnos.
                            </p>
                            <a href="#" data-bs-toggle="modal" data-bs-target="#supportModal"
                                class="btn btn-outline-light btn-sm">Soporte</a>
                        </div>
                    </div>
                </section>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content p-3">
            <!-- CONTENT: PAGE -->
            <section id="mainContent">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Inmuebles</h2>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#inmuebleModal">
                        <i class="fas fa-plus-circle"></i> Agregar Inmueble
                    </button>
                </div>

                <div class="table-responsive">
                    <table class="table table-striped table-bordered" id="inmueblesTable">
                        <thead class="table-dark">
                            <tr>
                                <th>Nombre</th>
                                <th>Dirección</th>
                                <!-- <th>Coordenadas</th> -->
                                <th>Tamaño</th>
                                <th>Cuartos</th>
                                <th>Baños</th>
                                <th>Valor</th>
                                <th>Fotos</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div class="map-section">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-6">
                                <h3 class="map-title">Ubicaciones de las propiedades</h3>
                                <div id="map"></div>
                            </div>
                            <div class="col-md-6">
                                <div id="info-casa">
                                    <h3 class="map-title">Fotografías</h3>
                                    <div class="image-gallery"></div>
                                    <div class="pagination-container mt-3">
                                        <button class="btn btn-secondary" id="prevImagePage" disabled>
                                            <i class="fas fa-caret-left"></i> Anterior
                                        </button>
                                        <span id="imagePageInfo"></span>
                                        <button class="btn btn-secondary" id="nextImagePage" disabled>
                                            Siguiente <i class="fas fa-caret-right"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- FOOTER: COPYRIGHT -->
            <footer class="footer">
                <p>&copy; 2024 RentalControl. Todos los derechos reservados.</p>
            </footer>
        </main>
    </div>

    <div class="modal fade" id="inmuebleModal" tabindex="-1" aria-labelledby="inmuebleModalLabel"
        data-bs-backdrop="static" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="inmuebleModalLabel">
                        Agregar Inmueble
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="inmuebleForm" enctype="multipart/form-data">
                        <input type="hidden" id="inmuebleId" />
                        <div class="row">
                            <div class="col-md-4 d-flex flex-column align-items-center">
                                <div class="mb-3 flex-grow-1 w-100">
                                    <div class="border form-control d-flex align-items-center justify-content-center">
                                        <img id="currentFoto" src="" alt="Foto actual" class="img-fluid" />
                                    </div>
                                </div>
                                <div class="mb-3 w-100">
                                    <label for="fotos" class="form-label">Fotos</label>
                                    <input type="file" class="form-control" id="fotos" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="nombre" class="form-label">Nombre</label>
                                    <input type="text" class="form-control" id="nombre" required />
                                </div>
                                <div class="mb-3">
                                    <label for="tamano" class="form-label">Tamaño</label>
                                    <input type="number" class="form-control" id="tamano" required />
                                </div>
                                <div class="mb-3">
                                    <label for="direccion" class="form-label">Dirección</label>
                                    <input type="text" class="form-control" id="direccion" required disabled />
                                </div>
                                <div class="mb-3">
                                    <input type="hidden" class="form-control" id="coordenadas" required disabled />
                                    <button type="button" class="btn btn-primary mt-2" id="selectLocationBtn">
                                        Seleccionar Ubicación
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="cuartos" class="form-label">Cuartos</label>
                                    <input type="number" class="form-control" id="cuartos" required />
                                </div>
                                <div class="mb-3">
                                    <label for="banos" class="form-label">Baños</label>
                                    <input type="number" class="form-control" id="banos" required />
                                </div>
                                <div class="mb-3">
                                    <label for="valor" class="form-label">Valor</label>
                                    <input type="number" class="form-control" id="valor" required />
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-success">Guardar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para seleccionar ubicación -->
    <div class="modal fade" id="locationModal" tabindex="-1" aria-labelledby="locationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="locationModalLabel">
                        Seleccionar Ubicación
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="selectMap" style="height: 400px"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        Cerrar
                    </button>
                    <button type="button" class="btn btn-primary" id="saveLocationBtn">
                        Guardar Ubicación
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Imagenes -->
    <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <button type="button" class="btn-close position-absolute top-0 end-0 m-2" data-bs-dismiss="modal"
                    aria-label="Close"></button>
                <div class="modal-body p-0">
                    <img id="modalImage" src="" alt="Imagen ampliada" class="img-fluid w-100" />
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: SUPPORT -->
    <div class="modal fade" id="supportModal" data-bs-backdrop="static" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <!-- MODAL: HEADER -->
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">
                        Formulario de Soporte
                    </h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <!-- MODAL: BODY -->
                <div class="modal-body">
                    <!-- SELECT TYPE SUPPORT -->
                    <div class="mb-3">
                        <label for="supportOption" class="form-label">Selecciona el tipo de soporte</label>
                        <select class="form-select" id="supportOption" onchange="toggleForm()">
                            <option value="" disabled selected>Elige una opción</option>
                            <option value="plan">Planes</option>
                            <option value="asistencia">Asistencia Técnica</option>
                        </select>
                    </div>

                    <!-- FORM: PLANS -->
                    <div id="plansForm" class="d-none">
                        <h5>Información del Plan</h5>
                        <p>
                            Por favor, ingresa tus datos para contratar o actualizar tu
                            plan. Nos pondremos en contacto contigo por teléfono o correo
                            para completar el proceso.
                        </p>

                        <!-- OPTIONS -->
                        <button class="btn btn-primary w-100" onclick="choosePlan('contratar')">
                            Contratar un Plan
                        </button>
                        <button class="btn btn-secondary w-100 mt-2" onclick="choosePlan('actualizar')">
                            Actualizar Plan
                        </button>

                        <!-- OPTIONS -->
                        <div id="planOptions" class="d-none mt-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="plan" id="proPlan" value="pro" />
                                <label class="form-check-label" for="proPlan">
                                    Plan Basic - $29.00 USD/mes
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="plan" id="premiumPlan"
                                    value="premium" />
                                <label class="form-check-label" for="premiumPlan">
                                    Plan Pro - $49.00 USD/mes
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="plan" id="diamondPlan"
                                    value="diamond" />
                                <label class="form-check-label" for="diamondPlan">
                                    Plan Premium - $99.00 USD/mes
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- TECHNICAL ASSISTANCE -->
                    <div id="supportForm" class="d-none">
                        <h5>Formulario de Asistencia Técnica</h5>
                        <p>
                            Por favor, ingresa tus datos para que podamos ayudarte. Nos
                            pondremos en contacto contigo por teléfono o correo.
                        </p>

                        <!-- TYPE OF HELP -->
                        <div class="mb-3">
                            <label for="helpType" class="form-label">Tipo de ayuda que necesitas</label>
                            <select class="form-select" id="helpType">
                                <option value="" disabled selected>
                                    Selecciona un tipo de ayuda
                                </option>
                                <option value="general">Consulta general</option>
                                <option value="tecnico">Asistencia técnica</option>
                                <option value="facturacion">Problemas de facturación</option>
                                <option value="cuenta">Problemas con la cuenta</option>
                            </select>
                        </div>
                    </div>

                    <hr />

                    <!-- INPUT FIELDS -->
                    <div id="commonFields" class="d-none">
                        <div class="mb-3">
                            <label for="userName" class="form-label">Nombre Completo</label>
                            <input type="text" class="form-control" id="userName" placeholder="Tu nombre completo"
                                required />
                            <div class="invalid-feedback" id="nameError">
                                Por favor, ingresa tu nombre completo.
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="userPhone" class="form-label">Teléfono</label>
                            <input type="tel" class="form-control" id="userPhone" placeholder="Tu número de teléfono"
                                required pattern="^[+]?[0-9]{10,15}$" />
                            <div class="invalid-feedback" id="phoneError">
                                Por favor, ingresa un número de teléfono válido (ejemplo:
                                +1234567890).
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="userEmail" class="form-label">Correo Electrónico</label>
                            <input type="email" class="form-control" id="userEmail" placeholder="Tu correo electrónico"
                                required />
                            <div class="invalid-feedback" id="emailError">
                                Por favor, ingresa un correo electrónico válido.
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="userMessage" class="form-label">Descripción de la consulta</label>
                            <textarea class="form-control" id="userMessage" rows="4"
                                placeholder="Describe tu consulta o solicitud" required></textarea>
                            <div class="invalid-feedback" id="messageError">
                                Por favor, ingresa una descripción de tu consulta.
                            </div>
                        </div>

                        <!-- SHOW SUPPORT SELECTED -->
                        <div id="selectedOption" class="d-none mb-3">
                            <label for="selectedOptionText" class="form-label">Opción seleccionada</label>
                            <textarea class="form-control" id="selectedOptionText" rows="2" disabled></textarea>
                        </div>
                    </div>
                </div>

                <!-- MODAL: FOOTER -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
                        Cerrar
                    </button>
                    <button type="button" class="btn btn-success" id="submitBtn">
                        Enviar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPTS JAVASCRIPT -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://kit.fontawesome.com/39d6703737.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.14.5/dist/sweetalert2.all.min.js"></script>
    <script type="module" src="../js/tabla.js"></script>
    <script src="../js/support.js"></script>
    <script>
        // Obtén el correo del usuario desde localStorage
        const userEmail = localStorage.getItem("userEmail");

        // Actualiza el contenido del elemento con el ID 'user-email'
        if (userEmail) {
            document.getElementById("user-email").textContent = userEmail;
        }

        // Manejar el cierre de sesión
        document.getElementById("logout").addEventListener("click", () => {
            import("../js/firebaseconfig.js").then(({ auth, signOut }) => {
                signOut(auth)
                    .then(() => {
                        localStorage.removeItem("userEmail");
                        window.location.href = "../pages/login.html";
                    })
                    .catch((error) => {
                        console.error("Error al cerrar sesión:", error);
                    });
            });
        });
    </script>
    <script>
        // Alternar la visibilidad de la sidebar
        document
            .getElementById("toggle-sidebar")
            .addEventListener("click", function () {
                var sidebar = document.getElementById("sidebar");
                if (
                    sidebar.style.display === "none" ||
                    sidebar.style.display === ""
                ) {
                    sidebar.style.display = "block";
                } else {
                    sidebar.style.display = "none";
                }
            });

        // Mostrar la sidebar automáticamente en pantallas grandes
        window.addEventListener("resize", function () {
            var sidebar = document.getElementById("sidebar");
            var toggleButton = document.getElementById("toggle-sidebar");
            if (window.innerWidth >= 992) {
                sidebar.style.display = "block";
            }
        });

        // Mostrar la sidebar al cargar la página si la pantalla es grande
        if (window.innerWidth >= 992) {
            document.getElementById("sidebar").style.display = "block";
        }

        // ...existing code...
        let selectedCoords = null;
        const selectMap = L.map("selectMap").setView([24.805, -107.394], 13);
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            attribution:
                '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        }).addTo(selectMap);

        let marker = null;
        selectMap.on("click", function (e) {
            if (marker) {
                selectMap.removeLayer(marker);
            }
            marker = L.marker(e.latlng).addTo(selectMap);
            selectedCoords = e.latlng;

            // Reverse geocoding
            fetch(
                `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${selectedCoords.lat}&lon=${selectedCoords.lng}`
            )
                .then((response) => response.json())
                .then((data) => {
                    document.getElementById("direccion").value = data.display_name;
                })
                .catch((error) =>
                    console.error("Error in reverse geocoding:", error)
                );
        });

        document
            .getElementById("selectLocationBtn")
            .addEventListener("click", function () {
                new bootstrap.Modal(document.getElementById("locationModal")).show();
            });

        document
            .getElementById("saveLocationBtn")
            .addEventListener("click", function () {
                if (selectedCoords) {
                    document.getElementById(
                        "coordenadas"
                    ).value = `${selectedCoords.lat}, ${selectedCoords.lng}`;
                    bootstrap.Modal.getInstance(
                        document.getElementById("locationModal")
                    ).hide();
                }
            });

        // Redimensionar el mapa cuando el modal se muestre
        $("#locationModal").on("shown.bs.modal", function () {
            setTimeout(function () {
                selectMap.invalidateSize();
            }, 10);
        });
        // ...existing code...
    </script>
</body>

</style>

</html>