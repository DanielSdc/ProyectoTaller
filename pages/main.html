<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Rental & Control</title>

    <link rel="icon" href="../img/logo_icono.webp" type="image/x-icon">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.14.5/dist/sweetalert2.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/main.css">

    <!-- STYLE PAGE -->
    <link rel="stylesheet" href="../css/inicio.css">
    <script type="module" src="../js/main.js"></script>
    <script type="module" src="../js/auth.js"></script>
</head>

<body class="layout-fixed">
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-custom fixed-top">
        <div class="container-fluid">
            <!-- COLUMN 1: LOGO AND PLAN -->
            <div class="d-flex align-items-center">
                <a href="../pages/main.html" class="navbar-brand">
                    <img src="../img/logo_2.png" alt="Logo Rental & Control">
                </a>
                <span class="navbar-text plan badge bg-gold text-dark ms-2">Premium</span>
            </div>

            <button id="toggle-sidebar" class="btn sidebar-toggle ms-auto d-lg-none">
                <i class="fas fa-bars"></i>
            </button>

            <!-- COLUMN 2: USER -->
            <div class="user-section">
                <span id="user-email" class="navbar-text d-none d-md-inline">Usuario</span>
                <div class="dropdown">
                    <a class="btn user-menu" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li class="dropdown-user-info">
                            <div class="d-flex align-items-center p-3">
                                <div class="user-avatar-sm me-3">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div>
                                    <h6 class="mb-0" id="user-name">Usuario</h6>
                                    <small id="user-email-dropdown" class="text-muted">usuario@correo.com</small>
                                </div>
                            </div>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="configuracion.html"><i class="fas fa-cog me-2"></i>Configuración</a></li>
                        <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#supportModal"><i class="fas fa-headset me-2"></i>Soporte</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" id="logout"><i class="fas fa-sign-out-alt me-2"></i>Cerrar sesión</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="wrapper">
        <!-- SIDEBAR -->
        <aside id="sidebar">
            <div class="sidebar-header d-flex d-lg-none align-items-center justify-content-between mb-4">
                <h5 class="mb-0">Menú</h5>
                <button class="btn-close sidebar-close text-white"></button>
            </div>
            
            <div class="d-flex flex-column align-items-start p-lg-3">
                <!-- SECTION: NAV -->
                <section class="sidebar-section">
                    <h5 class="sidebar-section-title">NAVEGACIÓN</h5>
                    <a href="main.html" class="sidebar-link active">
                        <span class="icon"><i class="fas fa-home"></i></span>
                        <span class="text">Dashboard</span>
                    </a>
                    <a href="inmuebles.html" class="sidebar-link">
                        <span class="icon"><i class="fas fa-building"></i></span>
                        <span class="text">Inmuebles</span>
                    </a>
                    <a href="rentas.html" class="sidebar-link">
                        <span class="icon"><i class="fas fa-file-invoice-dollar"></i></span>
                        <span class="text">Rentas</span>
                    </a>
                </section>

                <!-- SECTION: EXTRA -->
                <section class="sidebar-section">
                    <h5 class="sidebar-section-title">EXTRA</h5>
                    <a href="notas.html" class="sidebar-link">
                        <span class="icon"><i class="fas fa-sticky-note"></i></span>
                        <span class="text">Notas</span>
                    </a>

                </section>

                <!-- SECTION: SUPPORT -->
                <section class="sidebar-section">
                    <h5 class="sidebar-section-title">AYUDA</h5>
                    <div class="support-card">
                        <h6>Soporte Técnico</h6>
                        <p>¿Necesitas ayuda con la plataforma?</p>
                        <a href="#" data-bs-toggle="modal" data-bs-target="#supportModal" class="btn-support">
                            <i class="fas fa-headset me-2"></i>Contactar soporte
                        </a>
                    </div>
                </section>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="content">
            <!-- PAGE HEADER -->
            <div class="page-header">
                <div>
                    <h1 class="page-title">Dashboard</h1>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="#">Inicio</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
                        </ol>
                    </nav>
                </div>
                <div class="header-actions">
                    <span class="date-display"><i class="far fa-calendar-alt me-2"></i><span id="currentDate">Abril 7, 2025</span></span>
                </div>
            </div>

            <!-- CONTENT: PAGE -->
            <section id="mainContent">
                <!-- QUICK STATS -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="stat-card bg-success-gradient">
                            <div class="stat-card-body">
                                <div class="stat-card-icon">
                                    <i class="fas fa-dollar-sign"></i>
                                </div>
                                <div class="stat-card-info">
                                    <h6 class="stat-card-title">Ingreso Total Anual</h6>
                                    <p class="stat-card-value" id="totalIncome">$120,500.00</p>
                                    <p class="stat-card-change"><i class="fas fa-arrow-up"></i> 12% vs. año anterior</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stat-card bg-primary-gradient">
                            <div class="stat-card-body">
                                <div class="stat-card-icon">
                                    <i class="fas fa-file-invoice-dollar"></i>
                                </div>
                                <div class="stat-card-info">
                                    <h6 class="stat-card-title">Rentas Activas</h6>
                                    <p class="stat-card-value" id="totalRentas">24</p>
                                    <p class="stat-card-change"><i class="fas fa-arrow-up"></i> 3 nuevas este mes</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stat-card bg-dark-gradient">
                            <div class="stat-card-body">
                                <div class="stat-card-icon">
                                    <i class="fas fa-building"></i>
                                </div>
                                <div class="stat-card-info">
                                    <h6 class="stat-card-title">Total de Inmuebles</h6>
                                    <p class="stat-card-value" id="totalProperties">18</p>
                                    <p class="stat-card-change">2 disponibles para rentar</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PROPERTY SHOWCASE -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i class="fas fa-images me-2"></i>Fotografías de Inmuebles</h5>
                        </div>
                        <div class="card-body p-0">
                            <div id="carouselEx" class="carousel slide" data-bs-ride="carousel">
                                <div class="carousel-inner" id="carouselImages">
                                    <!-- Images will be dynamically loaded here -->
                                    <div class="carousel-item active">
                                        <div class="carousel-content">
                                            <div class="carousel-image-container">
                                                <img src="../img/casa1.webp" class="carousel-image" alt="Inmueble 1">
                                            </div>
                                            <div class="carousel-description">
                                                <h4>Casa Modelo Norte</h4>
                                                <div class="property-features">
                                                    <span><i class="fas fa-bed me-1"></i> 3 habitaciones</span>
                                                    <span><i class="fas fa-bath me-1"></i> 2 baños</span>
                                                    <span><i class="fas fa-ruler-combined me-1"></i> 180m²</span>
                                                </div>
                                                <p class="property-description">
                                                    Hermosa casa en zona residencial con excelente ubicación, amplio jardín y acabados de primera calidad. Perfecta para familias.
                                                </p>
                                                <a href="inmuebles.html" class="btn btn-primary btn-sm mt-2">
                                                    <i class="fas fa-info-circle me-1"></i> Ver detalles
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="carousel-item">
                                        <div class="carousel-content">
                                            <div class="carousel-image-container">
                                                <img src="../img/casa2.webp" class="carousel-image" alt="Inmueble 2">
                                            </div>
                                            <div class="carousel-description">
                                                <h4>Apartamento Centro</h4>
                                                <div class="property-features">
                                                    <span><i class="fas fa-bed me-1"></i> 2 habitaciones</span>
                                                    <span><i class="fas fa-bath me-1"></i> 1 baño</span>
                                                    <span><i class="fas fa-ruler-combined me-1"></i> 85m²</span>
                                                </div>
                                                <p class="property-description">
                                                    Moderno apartamento en el centro de la ciudad, cerca de zonas comerciales y transporte público. Incluye estacionamiento.
                                                </p>
                                                <a href="inmuebles.html" class="btn btn-primary btn-sm mt-2">
                                                    <i class="fas fa-info-circle me-1"></i> Ver detalles
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button class="carousel-control-prev" type="button" data-bs-target="#carouselEx" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Anterior</span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#carouselEx" data-bs-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Siguiente</span>
                                </button>
                                <div class="carousel-indicators">
                                    <button type="button" data-bs-target="#carouselEx" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                                    <button type="button" data-bs-target="#carouselEx" data-bs-slide-to="1" aria-label="Slide 2"></button>
                                </div>
                            </div>
                        </div>
                    </div>

                <!-- CHARTS AND UPCOMING DATES -->
                <div class="row">
                    <div class="col-lg-8 mb-4">
                        <div class="card h-100">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5><i class="fas fa-chart-line me-2"></i>Ingresos Mensuales</h5>
                                <div class="dropdown">
                                    <button class="btn btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        2025 <i class="fas fa-chevron-down ms-1"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end">
                                        <li><a class="dropdown-item" href="#">2025</a></li>
                                        <li><a class="dropdown-item" href="#">2024</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="card-body">
                                <canvas id="ingresosChart" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 mb-4">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5><i class="fas fa-calendar-alt me-2"></i>Próximas Fechas</h5>
                            </div>
                            <div class="card-body p-0">
                                <ul class="upcoming-events">
                                    <li class="upcoming-event">
                                        <div class="event-date">
                                            <span class="event-day">15</span>
                                            <span class="event-month">ABR</span>
                                        </div>
                                        <div class="event-info">
                                            <h6>Vencimiento de Renta</h6>
                                            <p>Apartamento Centro - Juan Pérez</p>
                                        </div>
                                        <span class="event-badge rent">Renta</span>
                                    </li>
                                    <li class="upcoming-event">
                                        <div class="event-date">
                                            <span class="event-day">20</span>
                                            <span class="event-month">ABR</span>
                                        </div>
                                        <div class="event-info">
                                            <h6>Mantenimiento Programado</h6>
                                            <p>Casa Modelo Norte - Plomería</p>
                                        </div>
                                        <span class="event-badge maintenance">Mant.</span>
                                    </li>
                                    <li class="upcoming-event">
                                        <div class="event-date">
                                            <span class="event-day">01</span>
                                            <span class="event-month">MAY</span>
                                        </div>
                                        <div class="event-info">
                                            <h6>Vencimiento de Contrato</h6>
                                            <p>Local Comercial Sur - Empresa XYZ</p>
                                        </div>
                                        <span class="event-badge contract">Contrato</span>
                                    </li>
                                </ul>
                                <div class="card-footer text-center">
                                    <a href="#" class="btn-view-all">Ver todas las fechas <i class="fas fa-arrow-right ms-1"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RECENT TRANSACTIONS -->
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-exchange-alt me-2"></i>Transacciones Recientes</h5>
                        <a href="#" class="btn-link">Ver todas</a>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table transactions-table">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Inmueble</th>
                                        <th>Inquilino</th>
                                        <th>Concepto</th>
                                        <th>Monto</th>
                                        <th>Estado</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>05 Abr 2025</td>
                                        <td>Casa Modelo Norte</td>
                                        <td>María Rodríguez</td>
                                        <td>Renta Abril</td>
                                        <td class="amount">$12,500.00</td>
                                        <td><span class="status-badge paid">Pagado</span></td>
                                        <td><a href="#" class="btn-action"><i class="fas fa-eye"></i></a></td>
                                    </tr>
                                    <tr>
                                        <td>03 Abr 2025</td>
                                        <td>Apartamento Centro</td>
                                        <td>Juan Pérez</td>
                                        <td>Renta Abril</td>
                                        <td class="amount">$8,800.00</td>
                                        <td><span class="status-badge paid">Pagado</span></td>
                                        <td><a href="#" class="btn-action"><i class="fas fa-eye"></i></a></td>
                                    </tr>
                                    <tr>
                                        <td>01 Abr 2025</td>
                                        <td>Local Comercial Sur</td>
                                        <td>Empresa XYZ</td>
                                        <td>Renta Abril</td>
                                        <td class="amount">$15,000.00</td>
                                        <td><span class="status-badge pending">Pendiente</span></td>
                                        <td><a href="#" class="btn-action"><i class="fas fa-eye"></i></a></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- FOOTER: COPYRIGHT -->
            <footer class="footer">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-md-6 text-center text-md-start">
                            <p>&copy; 2025 Rental & Control. Todos los derechos reservados.</p>
                        </div>
                        <div class="col-md-6 text-center text-md-end">
                            <p>Versión 2.3.0 | <a href="#" data-bs-toggle="modal" data-bs-target="#supportModal">Soporte</a></p>
                        </div>
                    </div>
                </div>
            </footer>
        </main>
    </div>

    <!-- MODAL: SUPPORT -->
    <div class="modal fade" id="supportModal" data-bs-backdrop="static" aria-labelledby="supportModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <!-- MODAL: HEADER -->
                <div class="modal-header">
                    <h5 class="modal-title" id="supportModalLabel">
                        <i class="fas fa-headset me-2"></i>Soporte Técnico
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <!-- MODAL: BODY -->
                <div class="modal-body">
                    <!-- SELECT TYPE SUPPORT -->
                    <div class="mb-4">
                        <label for="supportOption" class="form-label">¿En qué podemos ayudarte?</label>
                        <select class="form-select" id="supportOption" onchange="toggleForm()">
                            <option value="" disabled selected>Selecciona una opción</option>
                            <option value="plan">Planes y Facturación</option>
                            <option value="asistencia">Asistencia Técnica</option>
                        </select>
                    </div>

                    <!-- FORM: PLANS -->
                    <div id="plansForm" class="d-none">
                        <div class="support-section-header">
                            <h5>Información del Plan</h5>
                            <p>Por favor, indica los cambios que deseas realizar en tu plan actual.</p>
                        </div>

                        <!-- OPTIONS -->
                        <div class="row mb-3 g-3">
                            <div class="col-sm-6">
                                <button class="btn btn-outline-primary w-100 h-100 p-3" onclick="choosePlan('contratar')">
                                    <i class="fas fa-plus-circle fa-2x mb-2"></i>
                                    <h6>Contratar un Plan</h6>
                                    <p class="mb-0 small">Actualiza a un plan superior</p>
                                </button>
                            </div>
                            <div class="col-sm-6">
                                <button class="btn btn-outline-secondary w-100 h-100 p-3" onclick="choosePlan('actualizar')">
                                    <i class="fas fa-sync-alt fa-2x mb-2"></i>
                                    <h6>Actualizar Plan</h6>
                                    <p class="mb-0 small">Modifica tu plan actual</p>
                                </button>
                            </div>
                        </div>

                        <!-- PLAN OPTIONS -->
                        <div id="planOptions" class="d-none mt-4">
                            <h6 class="mb-3">Selecciona el plan deseado:</h6>
                            <div class="plans-container">
                                <div class="form-check plan-option">
                                    <input class="form-check-input" type="radio" name="plan" id="basicPlan" value="basic">
                                    <label class="form-check-label w-100" for="basicPlan">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <strong>Plan Basic</strong>
                                            <span class="badge bg-primary">$29.00 USD/mes</span>
                                        </div>
                                        <p class="text-muted mb-0 small">Hasta 5 inmuebles, soporte por email</p>
                                    </label>
                                </div>
                                <div class="form-check plan-option">
                                    <input class="form-check-input" type="radio" name="plan" id="proPlan" value="pro">
                                    <label class="form-check-label w-100" for="proPlan">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <strong>Plan Pro</strong>
                                            <span class="badge bg-primary">$49.00 USD/mes</span>
                                        </div>
                                        <p class="text-muted mb-0 small">Hasta 15 inmuebles, soporte prioritario</p>
                                    </label>
                                </div>
                                <div class="form-check plan-option">
                                    <input class="form-check-input" type="radio" name="plan" id="premiumPlan" value="premium">
                                    <label class="form-check-label w-100" for="premiumPlan">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <strong>Plan Premium</strong>
                                            <span class="badge bg-primary">$99.00 USD/mes</span>
                                        </div>
                                        <p class="text-muted mb-0 small">Inmuebles ilimitados, soporte 24/7, funciones avanzadas</p>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- TECHNICAL ASSISTANCE -->
                    <div id="supportForm" class="d-none">
                        <div class="support-section-header">
                            <h5>Asistencia Técnica</h5>
                            <p>Descríbenos tu problema para poder ayudarte de la mejor manera posible.</p>
                        </div>

                        <!-- TYPE OF HELP -->
                        <div class="mb-3">
                            <label for="helpType" class="form-label">Tipo de asistencia</label>
                            <select class="form-select" id="helpType">
                                <option value="" disabled selected>Selecciona un tipo de asistencia</option>
                                <option value="general">Consulta general</option>
                                <option value="tecnico">Problema técnico</option>
                                <option value="facturacion">Facturación y pagos</option>
                                <option value="cuenta">Configuración de cuenta</option>
                            </select>
                        </div>
                    </div>

                    <hr class="my-4">

                    <!-- COMMON FIELDS -->
                    <div id="commonFields" class="d-none">
                        <div class="mb-3">
                            <label for="userName" class="form-label">Nombre completo</label>
                            <input type="text" class="form-control" id="userName" placeholder="Tu nombre completo" required>
                            <div class="invalid-feedback" id="nameError">Por favor, ingresa tu nombre completo.</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="userPhone" class="form-label">Teléfono</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                    <input type="tel" class="form-control" id="userPhone" placeholder="Tu número de teléfono" required>
                                </div>
                                <div class="invalid-feedback" id="phoneError">Por favor, ingresa un número de teléfono válido.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="userEmail" class="form-label">Correo electrónico</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                    <input type="email" class="form-control" id="userEmail" placeholder="Tu correo electrónico" required>
                                </div>
                                <div class="invalid-feedback" id="emailError">Por favor, ingresa un correo electrónico válido.</div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="userMessage" class="form-label">Mensaje</label>
                            <textarea class="form-control" id="userMessage" rows="4" placeholder="Describe tu consulta o problema con detalle..." required></textarea>
                            <div class="invalid-feedback" id="messageError">Por favor, describe tu consulta.</div>
                        </div>

                        <!-- ATTACHMENT OPTION -->
                        <div class="mb-3">
                            <label for="fileAttachment" class="form-label">Adjuntar archivo (opcional)</label>
                            <input class="form-control" type="file" id="fileAttachment">
                            <div class="form-text">Máximo 5MB. Formatos permitidos: jpg, png, pdf.</div>
                        </div>

                        <!-- SELECTED OPTION SUMMARY -->
                        <div id="selectedOption" class="d-none alert alert-info mb-3">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-info-circle me-2"></i>
                                <span id="selectedOptionText"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MODAL: FOOTER -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-primary" id="submitBtn" disabled>
                        <i class="fas fa-paper-plane me-1"></i>Enviar solicitud
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPTS JAVASCRIPT -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.14.5/dist/sweetalert2.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="../js/firebaseconfig.js"></script>
    <script src="../js/support.js"></script>

    <script>
        // Current date display
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('currentDate').innerText = now.toLocaleDateString('es-ES', options);

        // Toggle sidebar on mobile
        document.getElementById('toggle-sidebar').addEventListener('click', function() {
            document.body.classList.toggle('sidebar-open');
        });

        // Close sidebar when clicking outside or on close button
        document.querySelector('.sidebar-close').addEventListener('click', function() {
            document.body.classList.remove('sidebar-open');
        });

        // Get user email from localStorage
        const userEmail = localStorage.getItem('userEmail') || 'usuario@correo.com';
        document.getElementById('user-email').textContent = userEmail;
        document.getElementById('user-email-dropdown').textContent = userEmail;
        
        // Set user name (could be modified to get from profile)
        const userName = userEmail.split('@')[0];
        document.getElementById('user-name').textContent = userName.charAt(0).toUpperCase() + userName.slice(1);

        // Logout handler
        document.getElementById('logout').addEventListener('click', () => {
            import('../js/firebaseconfig.js').then(({ auth, signOut }) => {
                signOut(auth).then(() => {
                    localStorage.removeItem('userEmail');
                    window.location.href = '../pages/login.html';
                }).catch((error) => {
                    console.error('Error al cerrar sesión:', error);
                });
            });
        });

        // Support form handlers
        function toggleForm() {
            const option = document.getElementById('supportOption').value;
            
            if (option === 'plan') {
                document.getElementById('plansForm').classList.remove('d-none');
                document.getElementById('supportForm').classList.add('d-none');
                document.getElementById('commonFields').classList.remove('d-none');
            } else if (option === 'asistencia') {
                document.getElementById('plansForm').classList.add('d-none');
                document.getElementById('supportForm').classList.remove('d-none');
                document.getElementById('commonFields').classList.remove('d-none');
            }
            
            document.getElementById('submitBtn').disabled = false;
        }

        function choosePlan(action) {
            const planOptions = document.getElementById('planOptions');
            planOptions.classList.remove('d-none');
            
            const selectedOption = document.getElementById('selectedOption');
            const selectedOptionText = document.getElementById('selectedOptionText');
            
            selectedOption.classList.remove('d-none');
            selectedOptionText.textContent = action === 'contratar' ? 
                'Has seleccionado contratar un nuevo plan.' : 
                'Has seleccionado actualizar tu plan actual.';
        }

        // Initialize demo chart
        window.addEventListener('DOMContentLoaded', () => {
            const ctx = document.getElementById('ingresosChart').getContext('2d');
            
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
                    datasets: [{
                        label: 'Ingresos 2025',
                        data: [12500, 13800, 14500, 15200, 16000, 16500, 17200, 17800, 18500, 19200, 19800, 20500],
                        backgroundColor: 'rgba(212, 196, 105, 0.7)',
                        borderColor: 'rgba(212, 196, 105, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                drawBorder: false
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        });
    </script>
</body>

</html>